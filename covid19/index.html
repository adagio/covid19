<!DOCTYPE html>
<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-363681-7"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-363681-7');
    </script>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Perú COVID-19</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

  </head>
  <body>
    <div id="floating-panel">
      <div class="group">
          <div class="subject">Situación al <span class="info">27 de marzo</span></div>
          <div class="subject-2">Casos confirmados: <span class="info number">&nbsp;635 (55+)</span></div>
          <div class="subject-2">Casos descartados: <span class="info number">9430 (791+)</span></div>
          <div class="subject-2">Fallecidos: <span class="info number">1 (2+)</span></div>
          <div class="subject-2">Fuente: 
              <span id="info">
                  <a href="https://twitter.com/Minsa_Peru/status/1243231800924782592">MINSA</a>
              </span>
          </div>
          <div class="subject-2"> 
              <span id="info">
                  <a href="https://github.com/jersson/jersson.github.io/tree/master/covid19">Sobre este proyecto</a>
              </span>
          </div>            
      </div>
    </div>
    <div id="map" class="tabcontent"></div>
    <div id="chart1" class="tabcontent">
      <canvas id="lineChart1" width="600" height="500px" ></canvas>
    </div>
    <div id="chart2" class="tabcontent">
      <canvas id="lineChart2" width="600" height="500px" ></canvas>
    </div>
    <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'map')">Mapa</button>
      <button class="tablinks" onclick="openTab(event, 'chart1')">Regiones (Top 5)</button>
      <button class="tablinks" onclick="openTab(event, 'chart2')">Diagnósticos</button>
    </div>
    <script>
      function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");

        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }

        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }

        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";

        document.getElementById('floating-panel').style.display = document.getElementById('map').style.display;
      }

      function initMap() {
        const maxI = 50, rad = 24, opac = .6;
        const url = 'https://us-central1-virtual-bonito-170805.cloudfunctions.net/covidPeru';
        document.getElementById('map').style.display = 'block';
        let map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: {lat: -10.151093, lng: -75.311132},
          mapTypeId: 'roadmap'
        });

        fetch(url).then(function(response) {
          response.json().then(function(result) {

            let locations = [];

            result.forEach(location => {

              let factor = 10 * location.confirmed;
              let i = 0;

              let image = './images/icons8-coronavirus-16.png';

              while (i < factor) {
                locations.push(new google.maps.LatLng(location.latitude, location.longitude));
                
                let contentString = `<div class="subject-2"><b>${location.title}</b><br/>Confirmados: <b>${location.confirmed}(${location.change})</b></div>`;
                let infowindow = new google.maps.InfoWindow({
                  content: contentString
                });

                let marker = new google.maps.Marker({
                  position: {lat: location.latitude, lng: location.longitude},
                  map: map,
                  icon: image
                });

                marker.addListener('click', function() {
                  infowindow.open(map, marker);
                });

                i++;
              }
            });

            let heatmap = new google.maps.visualization.HeatmapLayer({
              data: locations,
              map: map,
              maxIntensity: maxI,
              radius: rad,
              opacity: opac
            });
          });
        });
      }
    </script>

    <script>
     var lineChart1 = document.getElementById("lineChart1");
      new Chart(lineChart1, {
              type: 'line',
              data: {
                  // labels: ["20-03", "21-03", "22-03", "23-03", "24-03", "25-03", "26-03"],
                  labels: ["21-03", "22-03", "23-03", "24-03", "25-03", "26-03", "27-03"],
                  datasets: [{
                      // data: [263,318,363,395,416,480,580],
                      data: [318,363,395,416,480,580, 635],
                      label: "Perú",
                      borderColor: "#866969",
                      fill: false
                  }, {
                      // data: [220,241,278,307,322,369,453],
                      data: [241,278,307,322,369,453, 494],
                      label: "Lima",
                      borderColor: "#c45850",
                      fill: false
                  }, {
                      // data: [2,18,19,19,19,19,20],
                      data: [18,19,19,19,19,20, 20],
                      label: "Piura",
                      borderColor: "#8e5ea2",
                      fill: false
                  }, {
                      // data: [12,14,16,16,16,18,18],
                      data: [14,16,16,16,18,18,23],
                      label: "Loreto",
                      borderColor: "#3cba9f",
                      fill: false
                  }, {
                      // data: [3,4,7,7,9,10,15],
                      data: [4,7,7,9,10,15,15],
                      label: "Arequipa",
                      borderColor: "#e8c3b9",
                      fill: false
                  }, {
                      // data: [5,6,6,8,8,10,15],
                      data: [6,6,8,8,10,15,17],
                      label: "Callao",
                      borderColor: "#3e95cd",
                      fill: false
                  }
                  ]
              },
              options: {
                  maintainAspectRatio: false,
                  title: {
                      display: true,
                      position: 'top',
                      fontSize: 14,
                      text: 'Casos confirmados Perú + Top 5 regional, últimos 7 días'
                  },
                  legend: {
                      position: "bottom",
                      align: "start"
                  }
              }
          });

    </script>

    <script>
      var lineChart2 = document.getElementById("lineChart2");

      new Chart(lineChart2, {
              type: 'line',
              data: {
                  // labels: ["20-03", "21-03", "22-03", "23-03", "24-03", "25-03", "26-03"],
                  labels: ["21-03", "22-03", "23-03", "24-03", "25-03", "26-03", "27-03"],
                  datasets: [{
                      // data: [4069,5246,6184,6664,7013,8040,9219],
                      data: [5246,6184,6664,7013,8040,9219,10065],
                      label: "Evaluaciones",
                      borderColor: "#ffa500",
                      fill: false
                  }, {
                      // data: [4035,4928,5821,6269,6597,7560,8639],
                      data: [4928,5821,6269,6597,7560,8639, 9430],
                      label: "Descartados",
                      borderColor: "#00cc00",
                      fill: false
                  }, {
                      // data: [263,318,363,395,416,480,580],
                      data: [318,363,395,416,480,580, 635],
                      label: "Confirmados",
                      borderColor: "#c45850",
                      fill: false
                  }, {
                      // data: [7,7,8,8,8,9,9],
                      data: [7,8,8,8,9,9,11],
                      label: "Fallecimientos",
                      borderColor: "#000000",
                      fill: false
                  }
                  ]

              },
              options: {
                  maintainAspectRatio: false,
                  title: {
                      display: true,
                      position: 'top',
                      fontSize: 14,
                      text: 'Evaluaciones y resultados en Perú, últimos 7 días'
                  },
                  legend: {
                      position: "bottom",
                      align: "start"
                  }
              }
          });

    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAI_O3E19Z-dpWfXWIHXao6YYaYG9GmFJM&libraries=visualization&callback=initMap">
    </script>
  </body>
</html>